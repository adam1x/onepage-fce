function Course(a){this.year=a.year||"",this.section=a.section||"",this.type=a.type||"",this.courseid=a.courseid||"",this.resp_rate=a.resp_rate||"",this.semester=a.semester||"",this.name=a.name||"",this.enrollment=a.enrollment||"",this.co_taught=a.co_taught||"",this.department=a.department||"",this.responses=a.responses||"",this.instructor=a.instructor||"",this.questions=function(a){return q={},$.each(a.questions||{},function(a,b){b.body.startsWith("Q-")&&(q[b.body]=b.value)}),q}(a),this.getTable=function(){var a=[this.courseid,this.year,this.semester,this.instructor,normalizeScore(this.questions["Q-10"]),normalizeScore(this.questions["Q-09"]),normalizeScore(this.questions["Q-07"]),normalizeScore(this.questions["Q-02"]),this.questions["Q-01"],this.enrollment,this.resp_rate];return table="<tr><td>"+a.join("</td><td>")+"</td></tr>",table}}function normalizeScore(a){return Math.round((a-1)*25)}function search(a){var b,c,d=a.match(/(\d{2})[-]?(\d{3})/);null!==d?b=d[1]+"-"+d[2]:c=a;var f,e="https://courseapi-scotty.rhcloud.com/fce/_search?size=300&sort=year:desc&default_operator=AND";b?f=e.concat("&q=courseid:",b):c&&(f=e.concat("&q=instructor:",c)),f&&$.getJSON(f,function(a){var b=[],c="<br/>";try{var d=a.hits.hits;0==a.hits.total&&(c="Nothing was found.");for(i in d)hit=d[i],course=new Course(hit._source),b.push(course.getTable())}catch(a){c="Some thing went wrong. "+a}$("#result-body").remove(),$("#prompt-text").remove(),$("<tbody/>",{id:"result-body",html:b.join("")}).appendTo("#search-result"),$("<p/>",{id:"prompt-text",html:c}).appendTo("#prompt-div"),$("#search-result").removeAttr("data-sortable-initialized"),Sortable.init()})}function handleHashChange(){var a=decodeURIComponent(location.hash.slice(1));$("#search-form :input").val(a),search(a)}function setHash(a){var b=decodeURIComponent(location.hash.slice(1));if(a!=b){var c=encodeURIComponent(a);window.location.hash="#"+c}}$(function(){$("#search-form").on("submit",function(a){a.preventDefault();var b=$("#search-form :input").val();setHash(b),search(b)}),handleHashChange(),window.addEventListener("hashchange",handleHashChange)});
